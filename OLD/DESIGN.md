# KoeMojiAuto-cli 設計書

## 1. 概要

KoeMojiAuto-cliは、Whisperモデルを使用して音声・動画ファイルから自動文字起こしを行うコマンドラインツールです。本ドキュメントでは、シンプルなコマンドラインインターフェース（CLI）の設計について説明します。

## 2. 設計方針

### 2.1 KISS原則

「Keep It Simple, Stupid」の原則に則り、過度な複雑さを排除し、必要最小限の機能のみを実装します。

### 2.2 設計目標

- 外部依存関係なし（標準ライブラリのみ使用）
- シンプルな操作性（最小限のメニュー項目）
- 常時ログ表示（最新の処理状況を常に表示）
- 安定動作（エラーに強い実装）

## 3. ファイル構成

```
KoeMojiAuto-cli/
├── cli.py                 # CLIメインスクリプト
├── cli.bat                # CLI起動用バッチファイル
├── main.py                # 既存の処理エンジン（変更なし）
├── config.json            # 設定ファイル
├── start_koemoji.bat      # 処理開始用バッチファイル（既存）
├── stop_koemoji.bat       # 処理停止用バッチファイル（既存）
├── input/                 # 入力ファイル保存フォルダ
├── output/                # 出力ファイル保存フォルダ
└── archive/               # 処理済みファイル保存フォルダ
```

## 4. 機能説明

### 4.1 基本機能

1. **ステータス表示**: 現在の実行状態（実行中/停止中）を表示
2. **処理開始**: 文字起こしプロセスを開始
3. **処理停止**: 実行中の文字起こしプロセスを停止
4. **設定表示**: 現在の設定内容を表示
5. **リアルタイムログ表示**: 最新7行のログを常時表示

### 4.2 画面構成

```
=== KoeMojiAuto CLI ===
状態: 実行中

1. 開始
2. 停止
3. 設定表示
0. 終了

------------------------
最新ログ:
[日時] ログ内容1
[日時] ログ内容2
...（計7行）
------------------------

選択> _
```

## 5. 実装詳細

### 5.1 コア機能

1. **メインループ**: ユーザー入力を受け付け、選択に応じた処理を実行
2. **画面更新**: コマンド実行ごとに画面をクリアし、最新状態を表示
3. **状態確認**: 停止フラグファイルの有無でプロセス状態を判定
4. **ログ表示**: ログファイルの最新行を読み込んで表示

### 5.2 技術仕様

- **言語**: Python 3.x
- **依存関係**: なし（標準ライブラリのみ）
- **プラットフォーム**: Windows（バッチファイル使用）
- **インタラクション**: テキストベースの番号選択

### 5.3 実装ポイント

- **設定ファイル読み込み**: 複数エンコーディングに対応
- **エラーハンドリング**: 各処理でのエラーを捕捉し、プログラム停止を防止
- **ファイル存在確認**: 各種ファイル操作前に存在確認を実施

## 6. 使用方法

### 6.1 起動方法

1. `cli.bat`をダブルクリック
2. または、コマンドプロンプトから `cli.bat` を実行

### 6.2 操作方法

1. メニューから実行したい操作の番号を入力
2. エンターキーを押して実行
3. 設定表示画面からは、エンターキーでメインメニューに戻る

## 7. 拡張性

シンプルな設計ながらも、以下のような拡張可能性があります：

1. **設定編集機能**: メニューから直接設定を変更
2. **処理ファイル一覧**: 処理待ち/処理中/処理済みファイルの表示
3. **進捗表示**: 処理中ファイルの進捗パーセンテージ表示
4. **カラー表示**: 状態に応じた色分け表示

## 8. 制限事項

1. テキストベースインターフェースのため、グラフィカルな表現はなし
2. 処理の詳細な制御はコマンドライン引数では実現不可
3. 複数プラットフォーム対応は、バッチファイルの修正が必要

---

**作成日**: 2025年5月21日  
**作成者**: infoHiroki